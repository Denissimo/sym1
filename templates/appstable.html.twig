{% extends 'base.html.twig' %}
{% block body %}
    <div class="row mart10 oldfilter">
        <div class="col-3">
            <div class="card text-center bg-white1">
                <div class="card-header">
                    Дата создания - от
                </div>
                <div class="card-body">
                    <div class="col-10" id="datepick_create_from">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="card text-center bg-white1">
                <div class="card-header">
                    Дата создания - до
                </div>
                <div class="card-body">
                    <div class="col-10" id="datepick_create_to">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card text-center bg-white1">
                <div class="card-header">
                    Дата обработки - от
                </div>
                <div class="card-body">
                    <div class="col-10" id="datepick_update_from">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="card text-center bg-white1">
                <div class="card-header">
                    Дата обработки - до
                </div>
                <div class="card-body">
                    <div class="col-10" id="datepick_update_to">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row mart10">
            <div class="col-12 bg-white1">
                <p class="card-text">

                <div class="col-12 align-items-center">
                    <form class="form-inline">
                        {#<div class="row">#}
                        <div class="form-group mx-sm-2">
                            <input type="text" class="form-control" name="create_from" id="create_from"
                                   placeholder="Дата создания ОТ" value="{{ request.create_from }}"
                                   autocomplete="off">
                        </div>
                        <div class="form-group mx-sm-2">
                            <input type="text" class="form-control" name="create_to" id="create_to"
                                   placeholder="Дата создания ДО" value="{{ request.create_to }}"
                                   autocomplete="off">
                        </div>
                        <div class="form-group mx-sm-2">
                            <input type="text" class="form-control" name="update_from" id="update_from"
                                   placeholder="Дата обработки ОТ" value="{{ request.update_from }}"
                                   autocomplete="off">
                        </div>
                        <div class="form-group mx-sm-2">
                            <input type="text" class="form-control" name="update_to" id="update_to"
                                   placeholder="Дата обработки ДО" value="{{ request.update_to }}"
                                   autocomplete="off">
                        </div>

                        {% if access.all_apps %}
                            <div class="form-group mx-sm-2">
                                <select class="custom-select" name="userId">
                                    <option {% if not request.userId %} selected="selected" {% endif %} value="">Все
                                    </option>
                                    {% for user in Users %}
                                        <option {% if request.userId == user.id %} selected="selected" {% endif %}
                                                value="{{ user.id }}">{{ user.nameShort }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        {% endif %}
                        <div class="form-group mx-sm-2">
                            <select class="custom-select" name="filter">
                                <option selected value="">В работе</option>
                                <option value="new">Новые</option>
                                <option value="ready">Готовые</option>
                                <option value="trash">Корзина</option>
                            </select>
                        </div>
                        <div class="form-group mx-sm-2">
                            <select class="custom-select" name="limit">
                                <option selected value="50">50</option>
                                <option value="100">100</option>
                                <option value="150">150</option>
                                <option value="200">200</option>
                                <option value="250">250</option>
                                <option value="300">300</option>
                                <option value="350">350</option>
                                <option value="400">400</option>
                                <option value="450">450</option>
                                <option value="500">500</option>
                            </select>
                        </div>
                        <div class="form-group mx-sm-2">
                            <button type="submit" class="btn btn-sm btn-primary">Ok</button>
                        </div>
                    </form>
                </div>

                </p>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row mart10">
            <div class="loginform col-12 shadow-lg padt01 bg-white1">
                {#<p>&#x1F6AE</p>#}
                <table class="table table-striped appstable">
                    <tr>
                        <th>id</th>
                        {#<th></th>#}
                        <th>Клиент</th>
                        <th>Тел, Город</th>
                        <th>Оператор</th>
                        <th>Статус</th>
                        <th>Создано</th>
                        <th>Обработать</th>

                        <th>Комментарии</th>
                        <th></th>
                        <th>Добавить</th>
                    </tr>
                    {% for app in apps %}
                        <tr>
                            <td><a href="/app?app_id={{ app.id }}">{{ app.id }}</a>
                                {#</td>#}
                                {#<td>#}
                                {% if command_proc %}
                                    {{ include('sub_modal_btn_trash.html.twig', { 'article': article }) }}
                                {% endif %}
                            </td>
                            <td><a href="/app?app_id={{ app.id }}">{{ app.lastName }}&nbsp;{{ app.firstName }}
                                    &nbsp;{{ app.middleName }}</a></td>
                            <td>{{ app.phone }}<br/>{{ app.city }}</td>
                            <td>{{ app.userName }}</td>
                            {#<td><img src="/images/color_labels/{{ app.appStatus.picture }}" class="color_label" /> </td>#}
                            <td>
                                {#{{ app.status }}#}
                                <img src="/images/color_labels/{{ appstatus[app.status].picture }}"
                                     class="color_label"/>
                            </td>
                            {#<td>{{ appstatus[app.status].picture}}</td>#}
                            <td>{{ app.createdAtString }}</td>
                            <td>{{ app.updatedAtString }}</td>
                            {#<td>{{ app.lastComment.id }}</td>#}

                            <td>
                                {#{{ app.comments.0.id }}#}
                                <table class="table table-borderless table-sm table-small">
                                    {% for key, com in app.comments %}

                                        <tr class="row{% if key>0 %} collapse_row collapse_{{ app.id }}{% endif %}">
                                            {#<td>{{ com.id }}</td>#}
                                            <td class="col-3">{{ com.tsString }}</td>
                                            <td class="col-3">
                                                {% autoescape false %}
                                                    <a href="/user/?user_id={{ com.user.id }}">{{ com.user.nameShort|raw|replace({' ' : '&nbsp;'}) }}</a>
                                                {% endautoescape %}
                                            </td>
                                            <td class="col-3">{{ com.ctype.value }}</td>
                                            <td class="col-3">{{ com.reminderString }}{{ com.comment }}</td>
                                            {#<td class="col-4">{{ com.comment }}</td>#}

                                        </tr>
                                        {#{% if key==0 %}<div class="collapse" id="#collapse{{ app.id }}">{% endif %}#}
                                    {% endfor %}
                                    {#{% if app.comments | length %} </div> {% endif %}#}
                                </table>
                            </td>
                            <td>
                                {% if app.comments | length > 1 %}
                                    {{ include('sub_modal_btn_down.html.twig', { 'article': article }) }}
                                {% endif %}
                            </td>
                            <td>
                                {{ include('sub_modal_btn.html.twig', { 'article': article }) }}

                                {{ include('sub_modal.html.twig', { 'article': article }) }}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

{% endblock %}
